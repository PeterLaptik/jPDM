<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>jPDM admin page - groups</title>
    <h:outputStylesheet library="css" name="admin.css" />
    <h:outputStylesheet name="primeicons/primeicons.css"
        library="primefaces" />
    <h:outputStylesheet library="css" name="primeflex.css" />
    <h:outputStylesheet library="css" name="saga-blue.css" />
</h:head>

<h:body>
    <ui:include src="header.xhtml" />
    <div id="mainContainer">
    
        <!-- Left menu bar -->
        <div class="mainMenu">
            <!-- Main menu -->
            <p:menu>
                <p:menuitem value="Statistics" action="/test"
                    update="messages" ajax="false"
                    icon="pi pi-chart-bar" />
                <p:menuitem value="Users" outcome="users.xhtml"
                    update="messages" ajax="false"
                    icon="pi pi-user" />
                <p:menuitem value="Groups" outcome="groups.xhtml"
                    update="messages" ajax="false"
                    style="background-color: rgb(0 0 0 / 10%);"
                    icon="pi pi-users" />
                <p:menuitem value="Model" outcome="model.xhtml"
                    update="messages" ajax="false"
                    icon="pi pi-database" />
            </p:menu>
        </div>
        
        <!-- Groups table -->
        <div class="dgroupsTable">
            <h:form id="group-form">
            
                <!-- Create / delete tools -->
                <p:toolbar>
                    <p:toolbarGroup>
                        <h3>Groups</h3>
                    </p:toolbarGroup>
                    <p:toolbarGroup align="right">
                        <p:commandButton value="Create" icon="pi pi-plus"
                            style="margin-right: .5rem" styleClass="ui-button-success"
                            action="#{dlgCreateGroup.createGroupShow}">
                            <p:ajax event="dialogReturn" listener="#{groupManager.createGroupHandler}" update="growl-sticky, group-form:id-group-list" />
                        </p:commandButton>
                        <p:commandButton value="Clear" icon="pi pi-times-circle"
                            id="button-group-clear" styleClass="ui-button-warning"
                            style="margin-right: .5rem"
                            disabled="#{!groupManager.groupSelected}"
                            action="#{groupManager.clearSelectedGroup()}"
                            update="growl-sticky, user-form:id-user-list, group-form:button-group-clear, group-form:mcontext-group-form">
                            <p:confirm header="Confirmation" update="growl-sticky" message="Do you want to clear this group?" icon="pi pi-info-circle"/>
                        </p:commandButton>
                        <p:commandButton value="Delete" icon="pi pi-trash"
                            id="button-group-delete" styleClass="ui-button-danger"
                            disabled="#{!groupManager.groupSelected}"
                            action="#{groupManager.deleteSelectedGroup()}"
                            update="growl-sticky, id-group-list, group-form:button-group-delete, user-form:id-user-list, 
                                group-form:button-group-clear, group-form:mcontext-group-form">
                            <p:confirm header="Confirmation" update="growl-sticky" message="Do you want to delete this group?" icon="pi pi-info-circle"/>
                        </p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>
                
                <!-- Table -->
                <p:dataTable var="group" id="id-group-list"
                    value="#{groupManager.groupLazyList}" 
                    
                    paginator="true" rows="10"
                    paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                    rowsPerPageTemplate="5,10,15,25"
                    paginatorPosition="bottom"
                    
                    selectionMode="single"
                    selection="#{groupManager.selectedGroup}" rowKey="#{group.id}"
                    scrollable="true">
                    <p:column headerText="Name" 
                        sortBy="#{group.name}" filterBy="#{group.name}">
                        <h:outputText value="#{group.name}" />
                    </p:column>
                    <p:column headerText="Description" 
                        sortBy="#{group.description}" filterBy="#{group.description}">
                        <h:outputText value="#{user.name}" />
                    </p:column>
                    <p:ajax event="rowSelect" update="group-form:button-group-delete, group-form:button-group-clear, user-form:id-user-list" />
                    <p:ajax event="rowUnselect" update="group-form:button-group-delete, group-form:button-group-clear, user-form:id-user-list" />
                </p:dataTable>
                
                <!-- Pop up menu -->
                <p:contextMenu for="id-group-list" widgetVar="gMenu"
                    id="mcontext-group-form">
                    <p:menuitem value="Copy all Users" icon="pi pi-users"
                        action="#{groupManager.copyAllGroupUsers()}"
                        update="group-form:mcontext-group-form"/>
                    <p:menuitem value="Paste Users" icon="pi pi-user-plus"
                        action="#{groupManager.pasteAllGroupUsers()}"
                        disabled="#{!groupManager.hasCutUsers()}"
                        update="user-form:id-user-list group-form:mcontext-group-form"/>
                    <p:menuitem value="Cancel selection" icon="pi pi-times"
                        update="id-group-list, group-form:button-group-delete, user-form:id-user-list, 
                                group-form:button-group-clear, group-form:mcontext-group-form"
                        action="#{groupManager.resetSelection()}" />
                </p:contextMenu>
                
                <!-- Confirm delete operations -->
                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" />
                </p:confirmDialog>
                
            </h:form>
        </div>
        
        <!-- Users table -->
        <div class="Users table">
            <h:form id="user-form">
            
                <!-- Create / delete tools -->
                <p:toolbar>
                    <p:toolbarGroup>
                        <h3>Users</h3>
                    </p:toolbarGroup>
                </p:toolbar>
                
                <!-- Table -->
                <p:dataTable var="user" id="id-user-list"
                    value="#{groupManager.userLazyList}" 
                    
                    paginator="true" rows="10"
                    paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                    rowsPerPageTemplate="5,10,15,25"
                    paginatorPosition="bottom"
                    
                    selectionMode="multiple"
                    selection="#{groupManager.selectedUsers}" rowKey="#{user.id}"
                    scrollable="true">
                    <p:column headerText="Login" 
                        sortBy="#{user.login}" filterBy="#{user.login}">
                        <h:outputText value="#{user.login}" />
                    </p:column>
                    <p:column headerText="Name" 
                        sortBy="#{user.name}" filterBy="#{user.name}">
                        <h:outputText value="#{user.name}" />
                    </p:column>
                </p:dataTable>
                
                <!-- Pop up menu -->
                <p:contextMenu for="id-user-list" widgetVar="uMenu"
                    id="mcontext-department-form">
                    <p:menuitem value="Copy users" icon="pi pi-users"
                        action="#{groupManager.copySelectedUsers()}"
                        update="group-form:mcontext-group-form" />
                    <p:menuitem value="Remove" icon="pi pi-user-minus"
                        action="#{groupManager.removeUsersFromGroup()}"
                        update="growl-sticky, group-form:mcontext-group-form, user-form:id-user-list" />
                    <p:menuitem value="Cancel selection" icon="pi pi-times"
                        update="user-form:id-user-list, group-form:mcontext-group-form"
                        action="#{groupManager.resetUsersSelection()}" />
                </p:contextMenu>
            </h:form>
        </div>
    </div>
    <!-- Error messages container -->
    <p:growl id="growl-sticky" for="sticky-key" showDetail="true" autoUpdate="true"/>
</h:body>
</html>