<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
	
<h:head>
	<title>jPDM admin page</title>
	<h:outputStylesheet library="css" name="admin.css" />
	<h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
	<h:outputStylesheet library="css" name="primeflex.css" />
	<h:outputStylesheet library="css" name="saga-blue.css" />
</h:head>

<h:body>
    <ui:include src="header.xhtml" />
	<div id="mainContainer">
		<!-- Left menu bar -->
		<div class="mainMenu">
			<!-- Main menu -->
			<p:menu>
				<p:menuitem value="Statistics" action="/test" update="messages"
					ajax="false" icon="pi pi-external-link" />
				<p:menuitem value="Users" action="/test" update="messages"
					ajax="false" icon="pi pi-external-link"
					style="background-color: rgb(0 0 0 / 10%);"/>
				<p:menuitem value="Groups" action="/test" update="messages"
					ajax="false" icon="pi pi-external-link" />
				<p:menuitem value="Companies" action="/test" update="messages"
					ajax="false" icon="pi pi-external-link" />
			</p:menu>
		</div>

		<!-- Departments table -->
		<div class="departmentsTable">
			<h:form id="dep-form">
                <!-- Create / delete tools -->
				<p:toolbar>
					<p:toolbarGroup>
						<h3>Departments</h3>
					</p:toolbarGroup>
					<p:toolbarGroup align="right">
						<p:commandButton value="Create" icon="pi pi-plus"
							style="margin-right: .5rem" styleClass="ui-button-success"
							action="#{dlgCreateDep.createDepartmentShow}"
							update="id-departments-list">
							<p:ajax event="dialogReturn" update="dep-form:id-departments-list" />
						</p:commandButton>
						<p:commandButton value="Delete" icon="pi pi-trash"
							id="button-department-delete" styleClass="ui-button-danger"
							disabled="#{!userManager.hasSelectedDepartment()}"
							action="#{userManager.deleteDepartment}"
							update=":growl-sticky, user-form:id-user-list, dep-form:id-departments-list">
							<p:confirm header="Confirmation" update="growl-sticky" message="Do you want to delete this department?" icon="pi pi-info-circle"/>
						</p:commandButton>
					</p:toolbarGroup>
				</p:toolbar>
                <!-- Table -->
				<p:dataTable var="department" id="id-departments-list"
					value="#{userManager.departmentsList}" selectionMode="single"
					sortMode="multiple" selection="#{userManager.selectedDepartment}"
					rowKey="#{department.id}" scrollable="true">
					<p:column headerText="Name" sortBy="#{department.name}">
						<h:outputText value="#{department.name}" />
					</p:column>
					<p:column headerText="Description"
						sortBy="#{department.description}">
						<h:outputText value="#{department.description}" />
					</p:column>
					<p:ajax event="rowSelect"
						update="user-form:id-user-list, 
						dep-form:button-department-delete, 
						user-form:button-user-create, 
						user-form:button-user-delete" />
				</p:dataTable>

                <!-- Pop up menu -->
				<p:contextMenu for="id-departments-list" widgetVar="cMenu"
					id="mcontext-department-form">
					<p:menuitem value="Cut all Users" icon="pi pi-search"
						action="#{userManager.cutAllUsers()}"
						update="dep-form:mcontext-department-form"/>
					<p:menuitem value="Paste Users" icon="pi pi-search"
						action="#{userManager.pasteUsers()}"
						disabled="#{!userManager.hasCutUsers()}"
						update="user-form:id-user-list, user-form:button-user-create, user-form:button-user-delete,
								dep-form:mcontext-department-form"/>
					<p:menuitem value="Cancel selection" icon="pi pi-search"
						update="id-departments-list, dep-form:button-department-delete, user-form:id-user-list, 
							user-form:button-user-create, user-form:button-user-delete, dep-form:mcontext-department-form"
						action="#{userManager.resetSelection()}" />
				</p:contextMenu>
			</h:form>
		</div>

        <!-- Users table -->
		<div class="Users table">
			<h:form id="user-form">
                <!-- Create / delete tools -->
				<p:toolbar>
					<p:toolbarGroup>
						<h3>Users</h3>
					</p:toolbarGroup>
					<p:toolbarGroup align="right">
						<p:commandButton id="button-user-create" value="Create"
							icon="pi pi-plus" style="margin-right: .5rem"
							styleClass="ui-button-success"
							disabled="#{!userManager.hasSelectedDepartment()}"
							action="#{dlgCreateUser.createUserShow}">
							<p:ajax event="dialogReturn" update=":growl-sticky, id-user-list" />
							<f:param name="itemDepartment"
								value="#{userManager.selectedDepartment.id}" />
						</p:commandButton>
						<p:commandButton value="Delete" icon="pi pi-trash"
							id="button-user-delete" styleClass="ui-button-danger"
							disabled="#{!userManager.hasSelectedUsers()}"
							action="#{userManager.deleteUsers}"
							update=":growl-sticky, id-user-list">
								<p:confirm header="Confirmation" update="growl-sticky" message="Do you want to delete this user record(s)?" icon="pi pi-info-circle"/>
						</p:commandButton>
					</p:toolbarGroup>
				</p:toolbar>
                <!-- Table -->
				<p:dataTable var="user" id="id-user-list"
					value="#{userManager.userLazyList}" 
                    
                    paginator="true" rows="10"
                    paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                    rowsPerPageTemplate="5,10,15,25"
                    paginatorPosition="bottom"
                    
                    selectionMode="multiple"
					selection="#{userManager.selectedUsers}" rowKey="#{user.id}"
					scrollable="true">
					<p:column headerText="Login" 
                        sortBy="#{user.login}" filterBy="#{user.login}">
						<h:outputText value="#{user.login}" />
					</p:column>
					<p:column headerText="Name" 
                        sortBy="#{user.name}" filterBy="#{user.name}">
						<h:outputText value="#{user.name}" />
					</p:column>
					<p:ajax event="rowSelect" update="user-form:button-user-delete, user-form:mcontext-user-form" />
					<p:ajax event="rowUnselect" update="user-form:button-user-delete, user-form:mcontext-user-form" />
				</p:dataTable>
				
                <!-- Pop up menu -->
				<p:contextMenu for="id-user-list" widgetVar="uMenu" id="mcontext-user-form">
					<p:menuitem value="Cut Users" icon="pi pi-search"
						action="#{userManager.cutUsers()}"
						update="dep-form:mcontext-department-form"/>
					<p:menuitem value="Update password" icon="pi pi-search"
						action="#{dlgUpdatePassword.updatePasswordShow()}"
						disabled="#{!userManager.isSingleUserSelected()}">
						<p:ajax event="dialogReturn" update=":growl-sticky, id-user-list" />
					</p:menuitem>
					<p:menuitem value="Cancel selection" icon="pi pi-search"
						update="user-form:id-user-list, user-form:button-user-delete, dep-form:mcontext-department-form"
						action="#{userManager.resetUserSelection}" />
				</p:contextMenu>
				
                <!-- Confirm delete operations -->
				<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
				    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" />
				    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" />
				</p:confirmDialog>

			</h:form>
		</div>
	</div>
    <!-- Error messages container -->
	<p:growl id="growl-sticky" for="sticky-key" showDetail="true" autoUpdate="true"/>
</h:body>
</html>